version: '3.8'

services:
  sakura-vps-test:
    build:
      context: ..
      dockerfile: test/Dockerfile
    image: sakura-vps-test:latest
    container_name: sakura-vps-ubuntu
    hostname: sakura-vps
    privileged: true  # systemctlなどの実行に必要
    stdin_open: true
    tty: true
    ports:
      - "2222:22"   # SSH（ポート変更後用）
      - "8080:80"   # HTTP
      - "8443:443"  # HTTPS
    volumes:
      # スクリプトをリアルタイムで編集できるようにマウント
      - ../setup.sh:/home/ubuntu/setup.sh:ro
      # systemd対応
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    environment:
      - DEBIAN_FRONTEND=noninteractive
    networks:
      - vps-test-net

networks:
  vps-test-net:
    driver: bridge
